<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Number Plate Detection</title>
  <style>
    body { font-family: system-ui, Arial; background:#fafafa; text-align:center; }
    h1 { background:#111; color:#fff; padding:12px; margin:0 0 16px; }
    #video { border:3px solid #111; border-radius:10px; }
    button { margin:16px 6px; padding:10px 18px; border:0; border-radius:8px; cursor:pointer; }
    .primary { background:#2563eb; color:#fff; }
    .results { max-width:800px; margin:0 auto; text-align:left; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:12px; margin:10px 0; }
    .plate { font-weight:700; font-size:18px; }
    .owner { color:#374151; }
    .err { color:#dc2626; font-weight:600; }
    .muted { color:#6b7280; }
  </style>
</head>
<body>
  <h1>Number Plate Detection</h1>

  <img id="video" src="{{ url_for('video_feed') }}" width="640" height="480" alt="Live camera" />
  <div>
    <button class="primary" onclick="capture()">Capture & Detect</button>
  </div>

  <div id="results" class="results"></div>

  <script>
    async function capture() {
      const res = await fetch("/capture", { method: "POST" });
      const data = await res.json();
      const el = document.getElementById("results");
      el.innerHTML = "";

      if (data.error) {
        el.innerHTML = `<p class="err">${data.error}</p>`;
        return;
      }

      if (!Array.isArray(data) || data.length === 0) {
        el.innerHTML = `<p class="muted">No results.</p>`;
        return;
      }

      data.forEach(item => {
        const ownerHtml = (typeof item.owner === "object")
          ? `<div class="owner">üë§ ${item.owner.name} &middot; üìû ${item.owner.phone}</div>`
          : `<div class="owner">‚ùå Owner Not Found</div>`;

        el.innerHTML += `
          <div class="card">
            <div class="plate">üöò ${item.plate}</div>
            <div class="muted">Confidence: ${item.confidence ?? 0}</div>
            ${ownerHtml}
            ${item.bbox ? `<div class="muted">BBox: [${item.bbox.join(", ")}]</div>` : ""}
          </div>
        `;
      });
    }
  </script>
</body>
</html>
